<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Generador de Contratos</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config={theme:{extend:{}}}</script>
  <style>
    :root{--accent:#0ea5e9;--accent2:#22c55e;}
    .brand-gradient{background:linear-gradient(90deg,var(--accent),var(--accent2));}
    .input{background-color:#111827!important;border:1px solid #334155!important;border-radius:10px!important;padding:0.7rem 0.9rem!important;width:100%!important;color:#f8fafc!important;-webkit-text-fill-color:#f8fafc!important;font-weight:600!important;caret-color:#22d3ee!important;transition:all .15s ease-in-out;}
    .input::placeholder{color:#9ca3af;opacity:1;}
    .input:focus{outline:none;border-color:#22d3ee!important;box-shadow:0 0 0 2px #22d3ee55;background-color:#0f172a!important;}
    .btn{background:var(--accent);color:#001014;font-weight:700;border-radius:14px;padding:.7rem 1rem;text-align:center}
    .btn.alt{background:#334155;color:#e5e7eb}
    #loginOverlay{position:fixed;inset:0;background:rgba(2,6,23,.9);display:flex;align-items:center;justify-content:center;z-index:50;}
    .modal{position:fixed;inset:0;background:rgba(2,6,23,.8);display:none;align-items:center;justify-content:center;z-index:60;}
    .badge{font-size:.75rem;padding:.15rem .5rem;border-radius:999px;background:#0b4;color:#012;font-weight:700}
    .badge.gray{background:#374151;color:#e5e7eb}
  </style>
</head>
<body class="min-h-screen bg-slate-950 text-slate-100">

  <!-- LOGIN -->
  <div id="loginOverlay">
    <div class="w-[95%] max-w-md bg-slate-900/80 border border-slate-700 rounded-2xl p-6 backdrop-blur-md shadow">
      <h2 class="text-xl font-bold mb-4">Acceso</h2>
      <div class="space-y-3">
        <input id="loginUser" class="input" placeholder="Usuario" autocomplete="username" />
        <input id="loginPass" class="input" type="password" placeholder="Contraseña" autocomplete="current-password" />
        <button id="loginBtn" class="btn w-full">Ingresar</button>
        <p id="loginMsg" class="text-sm text-red-400 h-5"></p>
        <p class="text-xs opacity-70">*Nota: acceso local. No usar para datos sensibles.</p>
      </div>
    </div>
  </div>

  <!-- HEADER -->
  <header class="brand-gradient p-5 shadow-xl">
    <div class="flex items-center justify-between gap-3">
      <h1 class="text-2xl font-bold">GENERADOR DE CONTRATOS</h1>
      <div class="flex items-center gap-2">
        <span id="whoami" class="text-sm px-2 py-1 rounded bg-black/20"></span>
        <button id="btnConfig" class="text-sm px-3 py-1 rounded bg-black/20 hover:bg-black/30 hidden">Configuración</button>
        <button id="logoutBtn" class="text-sm px-3 py-1 rounded bg-black/20 hover:bg-black/30">Salir</button>
      </div>
    </div>
  </header>

  <!-- MODAL CONFIG -->
  <div id="configModal" class="modal">
    <div class="w-[95%] max-w-2xl bg-slate-900/90 border border-slate-700 rounded-2xl p-6 backdrop-blur-md shadow relative">
      <button id="closeConfig" class="absolute right-3 top-3 px-2 py-1 bg-slate-800/70 rounded">✕</button>
      <h2 class="text-xl font-bold mb-4">Configuración (Admin)</h2>

      <div class="space-y-3">
        <h3 class="font-semibold">Crear nuevo usuario</h3>
        <div class="grid sm:grid-cols-3 gap-3">
          <input id="newUser" class="input" placeholder="Usuario" />
          <input id="newPass" class="input" placeholder="Contraseña" type="password" />
          <select id="newRole" class="input">
            <option value="standard" selected>standard (solo uso)</option>
          </select>
        </div>
        <div class="flex gap-3">
          <button id="btnCreateUser" class="btn">Crear usuario</button>
          <p id="userMsg" class="text-sm opacity-80"></p>
        </div>
      </div>

      <hr class="my-5 border-slate-700/70"/>

      <div class="space-y-2">
        <h3 class="font-semibold">Usuarios registrados</h3>
        <div id="usersList" class="text-sm space-y-1"></div>
      </div>
    </div>
  </div>

  <!-- MAIN -->
  <main class="max-w-6xl mx-auto p-6 space-y-8">
    <section class="grid md:grid-cols-3 gap-6">
      <div class="md:col-span-2 space-y-6">
        <div class="bg-slate-900/60 rounded-2xl p-5 shadow">
          <h2 class="text-xl font-semibold mb-3">1) Datos del Representante Legal</h2>
          <div class="grid sm:grid-cols-2 gap-3">
            <input id="RAZON_SOCIAL" class="input" placeholder="RAZON SOCIAL" />
            <input id="RUC" class="input" placeholder="RUC" />
            <input id="DIRECCION" class="input" placeholder="DIRECCION" />
            <input id="NUMERO_DE_CALLE" class="input" placeholder="NUMERO DE CALLE" />
            <input id="DPTO_INT" class="input" placeholder="DPTO_INT" />
            <input id="URB" class="input" placeholder="URB" />
            <input id="DISTRITO" class="input" placeholder="DISTRITO" />
            <input id="CIUDAD" class="input" placeholder="CIUDAD" />
            <input id="APELLIDO_PATERNO" class="input" placeholder="APELLIDO PATERNO" />
            <input id="APELLIDO_MATERNO" class="input" placeholder="APELLIDO MATERNO" />
            <input id="NOMBRES" class="input" placeholder="NOMBRES" />
            <input id="CARGO" class="input" placeholder="CARGO" />
            <input id="DNI" class="input" placeholder="DNI" />
            <input id="TELEFONO" class="input" placeholder="TELEFONO" />
            <input id="CORREO" class="input col-span-2" placeholder="CORREO" />
          </div>
        </div>
      </div>
      <aside class="space-y-6">
        <div class="bg-slate-900/60 rounded-2xl p-5 shadow">
          <h2 class="text-lg font-semibold mb-3">Exportar PDFs</h2>
          <div class="flex flex-col gap-3">
            <button id="btnArr" class="btn">Exportar Arrendamiento.pdf</button>
            <button id="btnSup" class="btn">Exportar Servicios Suplementarios.pdf</button>
            <button id="btnTar" class="btn">Exportar Tarifas y Servicios.pdf</button>
            <button id="btnAll" class="btn alt">Exportar TODO</button>
            <a id="downloadLink" class="hidden btn" download>Descargar</a>
            <p id="status" class="text-sm opacity-80"></p>
          </div>
        </div>
      </aside>
    </section>
  </main>

  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <script>
    // === USUARIOS Y ROLES ===
    const USERS_KEY = 'contratos_users';
    const LOG_KEY = 'contratos_login_ok';
    const USER_KEY = 'contratos_login_user';
    const DEFAULT_ADMIN = {u:'mob_hmedinab',p:'adminMobilenet2025',role:'admin'};
    const DEFAULT_USER = {u:'usuario',p:'usuario123',role:'standard'};

    function loadUsers(){try{return JSON.parse(localStorage.getItem(USERS_KEY))||[]}catch{return []}}
    function saveUsers(a){localStorage.setItem(USERS_KEY,JSON.stringify(a))}
    function ensureDefaults(){
      const arr=loadUsers();
      if(!arr.some(x=>x.u===DEFAULT_ADMIN.u))arr.push(DEFAULT_ADMIN);
      if(!arr.some(x=>x.u===DEFAULT_USER.u))arr.push(DEFAULT_USER);
      saveUsers(arr);
    }
    function findUser(u){return loadUsers().find(x=>x.u===u)}
    function authUser(u,p){const user=findUser(u);return user&&user.p===p?user:null}
    function setLogged(o){localStorage.setItem(LOG_KEY,'1');localStorage.setItem(USER_KEY,JSON.stringify(o))}
    function getLogged(){try{return JSON.parse(localStorage.getItem(USER_KEY))}catch{return null}}
    function clearLogged(){localStorage.removeItem(LOG_KEY);localStorage.removeItem(USER_KEY)}

    // === LOGIN ===
    function showApp(){document.getElementById('loginOverlay').style.display='none';applyRoleUI();}
    function requireLogin(){
      ensureDefaults();
      const stored=getLogged();
      if(localStorage.getItem(LOG_KEY)==='1'&&stored){showApp();return;}
      const btn=document.getElementById('loginBtn');
      const msg=document.getElementById('loginMsg');
      btn.addEventListener('click',()=>{
        const u=document.getElementById('loginUser').value.trim();
        const p=document.getElementById('loginPass').value;
        const auth=authUser(u,p);
        if(auth){setLogged(auth);showApp();}
        else{msg.textContent='Usuario o contraseña incorrectos.';}
      });
    }
    requireLogin();
    document.getElementById('logoutBtn').addEventListener('click',()=>{clearLogged();location.reload();});

    // === CONFIG ADMIN ===
    const btnConfig=document.getElementById('btnConfig');
    const modal=document.getElementById('configModal');
    const closeCfg=document.getElementById('closeConfig');
    const usersList=document.getElementById('usersList');
    const whoami=document.getElementById('whoami');

    function applyRoleUI(){
      const me=getLogged();if(!me)return;
      whoami.textContent=`Sesión: ${me.u}`;
      const role=document.createElement('span');
      role.className='badge gray ml-2';role.textContent=me.role;whoami.appendChild(role);
      if(me.role==='admin')btnConfig.classList.remove('hidden');else btnConfig.classList.add('hidden');
    }
    function renderUsers(){
      const arr=loadUsers();usersList.innerHTML='';
      arr.forEach(u=>{
        const div=document.createElement('div');
        div.className='flex justify-between bg-slate-800/50 px-3 py-2 rounded';
        div.innerHTML=`<span>${u.u} <span class="badge gray ml-2">${u.role}</span></span><span class="text-xs opacity-70">guardado</span>`;
        usersList.appendChild(div);
      });
    }
    btnConfig.addEventListener('click',()=>{const me=getLogged();if(!me||me.role!=='admin')return;renderUsers();modal.style.display='flex';});
    closeCfg.addEventListener('click',()=>modal.style.display='none');
    modal.addEventListener('click',e=>{if(e.target===modal)modal.style.display='none';});
    document.getElementById('btnCreateUser').addEventListener('click',()=>{
      const me=getLogged();if(!me||me.role!=='admin')return;
      const msg=document.getElementById('userMsg');
      const u=document.getElementById('newUser').value.trim();
      const p=document.getElementById('newPass').value;
      let role=document.getElementById('newRole').value;
      if(role!=='standard')role='standard';
      if(!u||!p){msg.textContent='Completa usuario y contraseña.';return;}
      const arr=loadUsers();if(arr.some(x=>x.u===u)){msg.textContent='Ese usuario ya existe.';return;}
      arr.push({u,p,role});saveUsers(arr);
      renderUsers();msg.textContent='Usuario creado.';setTimeout(()=>msg.textContent='',1500);
      document.getElementById('newUser').value='';document.getElementById('newPass').value='';
    });
  </script>
</body>
</html>
